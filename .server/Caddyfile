{
    # On-Demand TLS configuration
    on_demand_tls {
        ask http://localhost:5555/check
        interval 2m
        burst 5
    }
}

# Match 2 levels of subdomains: {pr}.{project}.github.klinki.cz
*.*.github.klinki.cz {
    tls {
        on_demand
    }

    # Map the subdomain to a directory
    # For domain 'pr-23.bookmarks.github.klinki.cz':
    # labels.0 = cz
    # labels.1 = klinki
    # labels.2 = github
    # labels.3 = bookmarks (project)
    # labels.4 = pr-23     (PR folder)

    root * /var/www/{labels.3}/{labels.4}

    # Enable file server
    file_server

    # SPA Fallback (for Angular)
    try_files {path} /index.html
}
